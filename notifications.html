<!-- notifications.html -->
<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Notifications</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 p-4">

  <a href="/home.html" class="text-indigo-600 dark:text-indigo-400 hover:underline block mb-4">&larr; Back to Home</a>
  <h1 class="text-2xl font-bold text-center text-indigo-600 mb-6">Notifications</h1>

  <div id="notifications" class="space-y-4"></div>
  <!-- Mobile Bottom Navigation -->
<nav class="md:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 p-2 flex justify-around">
    <a href="home.html" class="p-2 rounded-md text-indigo-500 bg-gray-100 dark:bg-gray-700">
        <!-- Home -->
        <svg class="h-7 w-7" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path>
        </svg>
    </a>

    <a href="#" class="p-2 rounded-md text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-indigo-500">
        <!-- Posts -->
        <svg class="h-7 w-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"></path>
        </svg>
    </a>

    <a href="notifications.html" class="p-2 rounded-md text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-indigo-500">
        <!-- Notifications -->
        <svg class="h-7 w-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
        </svg>
    </a>

    <a href="friends.html" class="p-2 rounded-md text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 hover:text-indigo-500">
        <!-- ðŸ‘¤ This was Profile, now goes to Friends -->
        <svg class="h-7 w-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
        </svg>
    </a>
</nav>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, query, orderBy, onSnapshot, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCh4rG-JBamK1YVjZIKy49BL7sO_cUzuog",
      authDomain: "idr-488b2.firebaseapp.com",
      projectId: "idr-488b2",
      storageBucket: "idr-488b2.appspot.com",
      messagingSenderId: "220979507758",
      appId: "1:220979507758:web:d2860ac10cfb58ad5725bf"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const notificationsContainer = document.getElementById("notifications");

    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "/index.html";
        return;
      }

      const notifRef = collection(db, "users", user.uid, "notifications");
      const notifQuery = query(notifRef, orderBy("timestamp", "desc"));

      onSnapshot(notifQuery, async (snapshot) => {
        notificationsContainer.innerHTML = "";
        snapshot.forEach(async (docSnap) => {
          const notif = docSnap.data();

          let message = "";
          let link = "#";
          const fromSnap = await getDoc(doc(db, "users", notif.fromUserId));
          const fromUser = fromSnap.data();

          if (notif.type === "like") {
            message = `<strong>${fromUser.name}</strong> liked your post.`;
            link = `/post.html?id=${notif.postId}`;
          } else if (notif.type === "comment") {
            message = `<strong>${fromUser.name}</strong> commented on your post.`;
            link = `/post.html?id=${notif.postId}`;
          } else if (notif.type === "follow") {
            message = `<strong>${fromUser.name}</strong> followed you.`;
            link = `/user.html?id=${notif.fromUserId}`;
          }

          const div = document.createElement("div");
          div.className = "bg-white dark:bg-gray-800 p-4 rounded shadow";
          div.innerHTML = `
            <a href="${link}" class="hover:underline">
              <p>${message}</p>
              <p class="text-sm text-gray-500 mt-1">${new Date(notif.timestamp?.toDate()).toLocaleString()}</p>
            </a>
          `;

          notificationsContainer.appendChild(div);

          // Mark as read (optional)
          if (!notif.read) {
            await updateDoc(doc(db, "users", user.uid, "notifications", docSnap.id), {
              read: true
            });
          }
        });
      });
    });
  </script>
</body>
</html>
